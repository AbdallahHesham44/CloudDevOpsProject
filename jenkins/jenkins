@Library('my-shared-library-2@main') _
pipeline {
    agent any

    tools {
        gradle 'Gradle' // Ensure this matches your Jenkins setup
    }

    environment {
        DOCKER_IMAGE = 'docker.io/abdallah1312/ivolve-app:latest'
        kubeconfigPath = '/home/abdallah/.kube/config'
        deploymentYaml = 'Kubernetes/deployment.yaml' // Define your Kubernetes deployment YAML path
    }

    stages {
        checkoutCode()           // Calling the checkout stage
        setPermissions()         // Calling the set permissions stage
        build()                  // Calling the build stage
        sonarQubeAnalysis()      // Calling the SonarQube analysis stage
        dockerLogin()            // Calling the Docker login stage
        dockerBuild()            // Calling the Docker build stage
        dockerPush()             // Calling the Docker push stage
        setupKubernetes()        // Calling the Kubernetes setup stage
        deployToKind()           // Calling the deploy to Kind stage
    }

    post {
        always {
            cleanWs()
        }
        success {
            echo 'Build successful!'
        }
        failure {
            echo 'Build failed.'
        }
    }
}
